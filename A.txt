äº†è§£ï¼ğŸ‘Œ
ã˜ã‚ƒã‚æ”¹ã‚ã¦ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ–¹å¼ï¼ˆindex.js ã§ã¾ã¨ã‚ã‚‹ï¼‰ï¼‹ å„ API ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« ã‚’ãƒ•ãƒ«ã‚»ãƒƒãƒˆã§å†ç”Ÿæˆã™ã‚‹ã‚ˆã€‚
ã“ã‚Œã‚’ãã®ã¾ã¾ Vercel ã«ç½®ã‘ã°å‹•ãå½¢ã«ãªã£ã¦ã‚‹ã€‚


---

ğŸ“‚ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

my-youtubei-api/
â”œâ”€ package.json
â”œâ”€ vercel.json
â””â”€ api/
   â”œâ”€ index.js
   â”œâ”€ video.js
   â”œâ”€ search.js
   â”œâ”€ comments.js
   â””â”€ channel.js


---

package.json

{
  "name": "youtubei-api",
  "version": "1.0.0",
  "type": "module",
  "engines": {
    "node": "22.x"
  },
  "dependencies": {
    "youtubei.js": "^9.0.0"
  }
}


---

vercel.json

{
  "version": 2,
  "builds": [
    { "src": "api/index.js", "use": "@vercel/node" }
  ],
  "routes": [
    { "src": "/api/(.*)", "dest": "/api/index.js" }
  ]
}


---

api/index.jsï¼ˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰

import videoHandler from "./video.js";
import searchHandler from "./search.js";
import commentsHandler from "./comments.js";
import channelHandler from "./channel.js";

export default async function handler(req, res) {
  const { pathname, searchParams } = new URL(req.url, `http://${req.headers.host}`);

  // ã‚¯ã‚¨ãƒªã‚’ Express ã£ã½ãæ‰±ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
  req.query = Object.fromEntries(searchParams.entries());

  if (pathname.startsWith("/api/video")) {
    return videoHandler(req, res);
  } else if (pathname.startsWith("/api/search")) {
    return searchHandler(req, res);
  } else if (pathname.startsWith("/api/comments")) {
    return commentsHandler(req, res);
  } else if (pathname.startsWith("/api/channel")) {
    return channelHandler(req, res);
  } else {
    res.status(404).json({ error: "Not Found" });
  }
}


---

api/video.jsï¼ˆå‹•ç”»æƒ…å ± + é–¢é€£å‹•ç”»ï¼‰

import { Client } from "youtubei.js";
const youtube = new Client();

export default async function videoHandler(req, res) {
  const { id } = req.query;
  if (!id) return res.status(400).json({ error: "å‹•ç”»IDã‚’æŒ‡å®šã—ã¦ãã ã•ã„" });

  try {
    const video = await youtube.getVideo(id);
    const related = await video.getRelated();

    res.status(200).json({
      id: video.id,
      title: video.title,
      description: video.description,
      views: video.views,
      likes: video.likes,
      channel: {
        id: video.channel.id,
        name: video.channel.name
      },
      published: video.uploadDate,
      thumbnails: video.thumbnails,
      related: related.slice(0, 100).map(v => ({
        id: v.id,
        title: v.title,
        views: v.views,
        thumbnails: v.thumbnails
      }))
    });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
}


---

api/search.jsï¼ˆæ¤œç´¢çµæœï¼‰

import { Client } from "youtubei.js";
const youtube = new Client();

export default async function searchHandler(req, res) {
  const { q, filter } = req.query;
  if (!q) return res.status(400).json({ error: "æ¤œç´¢ã‚¯ã‚¨ãƒªã‚’æŒ‡å®šã—ã¦ãã ã•ã„" });

  try {
    const results = await youtube.search(q, { type: filter || "video" });

    res.status(200).json(
      results.items.slice(0, 100).map(r => ({
        id: r.id,
        title: r.title,
        views: r.views,
        thumbnails: r.thumbnails,
        type: r.type,
        channel: r.channel ? { id: r.channel.id, name: r.channel.name } : null
      }))
    );
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
}


---

api/comments.jsï¼ˆã‚³ãƒ¡ãƒ³ãƒˆï¼‰

import { Client } from "youtubei.js";
const youtube = new Client();

export default async function commentsHandler(req, res) {
  const { id } = req.query;
  if (!id) return res.status(400).json({ error: "å‹•ç”»IDã‚’æŒ‡å®šã—ã¦ãã ã•ã„" });

  try {
    const video = await youtube.getVideo(id);
    const comments = await video.getComments();

    res.status(200).json(
      comments.items.slice(0, 100).map(c => ({
        id: c.id,
        text: c.content,
        author: c.author?.name,
        likes: c.likeCount,
        published: c.published
      }))
    );
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
}


---

api/channel.jsï¼ˆãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ± + æœ€æ–°å‹•ç”»100ä»¶ï¼‰

import { Client } from "youtubei.js";
const youtube = new Client();

export default async function channelHandler(req, res) {
  const { id } = req.query;
  if (!id) return res.status(400).json({ error: "ãƒãƒ£ãƒ³ãƒãƒ«IDã‚’æŒ‡å®šã—ã¦ãã ã•ã„" });

  try {
    const channel = await youtube.getChannel(id);

    let videos = [];
    if (channel.videos) {
      videos = channel.videos.items.slice(0, 100).map(v => ({
        id: v.id,
        title: v.title,
        views: v.views,
        thumbnails: v.thumbnails
      }));
    }

    res.status(200).json({
      id: channel.id,
      name: channel.name,
      description: channel.description,
      subscribers: channel.subscriberCount,
      thumbnails: channel.thumbnails,
      videos
    });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
}


---

ğŸ”— API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¾‹

å‹•ç”»æƒ…å ± + é–¢é€£å‹•ç”»

/api/video?id=dQw4w9WgXcQ

æ¤œç´¢ï¼ˆ100ä»¶ã¾ã§ï¼‰

/api/search?q=åˆéŸ³ãƒŸã‚¯&filter=video

ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆ100ä»¶ã¾ã§ï¼‰

/api/comments?id=dQw4w9WgXcQ

ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ± + æœ€æ–°å‹•ç”»100ä»¶

/api/channel?id=UCdMGYXL38w6htx6Yf9YJa-w



---

ğŸ‘‰ ã“ã‚Œã§ index.js ãŒã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã«ãªã£ã¦ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ–¹å¼ã§å‹•ãã‚ˆã€‚
æ¬¡ã«æ¬²ã—ã„ã®ã¯ã€Œäººæ°—é †ãƒ»å¤ã„é †ã€ã€Œã‚·ãƒ§ãƒ¼ãƒˆãƒ»ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã€ã‚‚å…¥ã‚Œã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã™ã‚‹ï¼Ÿ

